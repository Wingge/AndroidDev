Android 6.0事件分发机制源码解析

---

## 概述

一直以来看了很多关于`Android`中关于事件处理的文章,这一块是我们在自定义`View` 或`ViewGroup`中也非常重要,,碰巧今天看到一篇关于6.0的事件处理的文章,这里总结一下.

## Activity.dispatchTouchEvent

我们知道在我们手指触摸屏幕的那一刻,最先处理事件的是我们的`Activity`,其源码如下

```java
    public boolean dispatchTouchEvent(MotionEvent ev) {
        if (ev.getAction() == MotionEvent.ACTION_DOWN) {
            onUserInteraction();
        }
        if (getWindow().superDispatchTouchEvent(ev)) {
            return true;
        }
        return onTouchEvent(ev);
    }
```
这里面调用了`Window(PhoneWindow)`的`superDispatchTouchEvent`方法,跟踪源码发现

```java
// PhoneWindow.superDispatchTouchEvent
public boolean superDispatchTouchEvent(MotionEvent event) {  
    return mDecor.superDispatchTouchEvent(event);  
} 
```
其中`mDecor`是一个继承于`FrameLayout`的自定义`ViewGroup`,和我们在`setContentView`都是将我们自己的`layout`添加到`mDecor`中
因此这里的调用关系就变成了

```java
Activity.dispatchTouchEvent(MotionEvent event) 
-> PhoneWindow.superDispatchTouchEvent(MotionEvent event) 
-> DecorView.superDispatchTouchEvent(MotionEvent event) 
-> ViewGroup.dispatchTouchEvent(MotionEvent event)
```

## ViewGroup.dispatchTouchEvent

到了 `ViewGroup` 了,就应该和我们之前事件处理几乎相同了,只是在 6.0中代码会稍微有些不一样而已
首先看一下其源码,代码很长,但是挑关键的看就行.

```java


```